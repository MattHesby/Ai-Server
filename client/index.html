<!doctype html>
<html lang="en" ng-app>

<head>
    <link rel="shortcut icon" href="imgs/favicon.ico" />
  <script src="/socket.io/socket.io.js"></script>

  <title>Vindinium</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      padding-top: 60px;
    }

    canvas {
      border: 3px solid #d3d3d3;
      position: absolute;
      top: 0px;
      left: 0px;
    }
    
.slider {
    -webkit-appearance: none;
    width: 100%;
    background: #7c7c7c;
    height: 4px;
    outline: none;
    cursor: pointer;
}

.slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 100%;
    background: #ff2828;
    cursor: pointer;
}
    
  </style>

</head>

<body>



<div id = "winner" style = "font-weight: bold; font-size: 150%; background: white;z-index: 2; position: absolute; text-align: center; border: 1px solid; display: none; padding: auto; margin: 100px; top: 230px; left: 210px; ">
</div>


<div style = "position: absolute; left: 22.5%; top:0px; width: 900px;">
      <button id = "saveGame" style = "position: absolute;top: 723px; left: 300px; display: none;">Save this Game</button>
            <button id = "unsaveGame" style = "position: absolute;top: 723px; left: 300px; display: none;">Unsave this Game</button>
  <button id = "watchlive" style = "position: absolute;top: 723px; left: 150px; display: none; ">Watch live games</button>

<input type="range" min="0" max="200" value="0" id="time" style = "display: none;position: absolute; top: 700px; left: 9px; float: left; width: 600px; padding: 0px; z-index: 100000;" class = "slider"></input>
<input id = "speed" type = "range" min = "4" max = "300" value = "254" style = "position: absolute; top:  723px; left: 7px;float: left; display: none;"></input>

  </div>

<h1 style = "position: absolute; top: -10px; left: 40%;">Vindinium</h1>
<a  target="_blank" style = "font-size: 20px; position: relative; left: 41%;"href = "https://docs.google.com/spreadsheets/d/14E42sKLUmX5AUokzlq_1Aj-xZ-I5DlcrTohz5NM_cjE/edit#gid=0">Documentation</a><br>
<a  target="_blank" style = "font-size: 20px; position: relative; left: 40%;"href = "https://gorgamite.github.io/JSON/randomProjects/Draw/">Map Making Tool</a>
<div style = "position:absolute; left: 23%;">
  <canvas id="canvas" width="600px" height="600px" style="position: relative; float: left;"></canvas>
  <canvas id = "energyDisplay" width = "20px" height = "600px" style = "position: relative; float: left;"></canvas>
  </div>

<div style = "position: absolute;top: 759px; left: 23%;">
<div style = "position: relative;  border: 1px solid; text-align: center; display: inline-block; vertical-align:top;"id = "names">
  <b>Recent Games (Last 20)</b>
    </div>
    <div style = "position: relative;  border: 1px solid; text-align: center;  display: inline-block; vertical-align:top;"id = "saved">
   <b>   Saved Games</b> <br>
   <button onclick = "clearSavedGames();">Clear</button>
      </div>
          <div style = "position: relative;  border: 1px solid; text-align: center; display: inline-block; vertical-align:top; "id = "leaderboard">
    <b>  Leaderboard</b>
      </div>
      </div>

  

  <div style="display: none;">
    <img src = "imgs/onair.png" id = "live"/>
    
    
    <img src="imgs/redbackwards.png" id="rednorth" />
    <img src="imgs/redforwards.png" id="redsouth" />
    <img src="imgs/redright.png" id="redeast" />
    <img src="imgs/redleft.png" id="redwest" />

    <img src="imgs/bluebackwards.png" id="bluenorth" />
    <img src="imgs/blueforwards.png" id="bluesouth" />
    <img src="imgs/blueright.png" id="blueeast" />
    <img src="imgs/blueleft.png" id="bluewest" />

    <img src="imgs/greybackwards.png" id="greynorth" />
    <img src="imgs/greyforwards.png" id="greysouth" />
    <img src="imgs/greyright.png" id="greyeast" />
    <img src="imgs/greyleft.png" id="greywest" />

    <img src="imgs/yellowbackwards.png" id="yellownorth" />
    <img src="imgs/yellowforwards.png" id="yellowsouth" />
    <img src="imgs/yellowright.png" id="yelloweast" />
    <img src="imgs/yellowleft.png" id="yellowwest" />
  </div>
  <div style="position: absolute; top: 100px; left: 75%;">
    <input id="username" placeholder = "Username (Less than 30 chars)"></input>
    <button id="create">Create a bot</button>
    <div id="after"></div>
    <div id="scoreboard" style="display: inline-block;">
      <p id = "turnStr"></p>
      <select id="selectGame">
  <option value="0">Game 1</option>
  <option value="1">Game 2</option>
  <option value="2">Game 3</option>
  <option value="3">Game 4</option>
    <option value="4">Game 5</option>
</select>
<br>
      <div id = "player0" style = "border: 7px solid; display: inline-block; padding: 5px; border-color: red;"></div>
<br>
<div id = "player1" style = "border: 7px solid; display: inline-block; padding: 5px; border-color: #2172ff; "></div>
<br>
<div id= "player2" style = "border:7px solid; display: inline-block; padding: 5px; border-color: #ffcc00; "></div>
<br>
<div id = "player3" style = "border: 7px solid; display: inline-block; padding: 5px; border-color: grey; "></div>
    </div>
  </div>
  <script src="/js/jquery.min.js"></script>
  <script>
  const key = Math.random().toString(36).substr(2, 35); //"Render" the key immediately so it can't be modified through console.
  let savedGameInd;
  var stringArr;
  var rerunObj;
  var lastCoords;
    var barricades = [];
    var socket = io.connect();
    let winText =  document.getElementById("winner");
    var btn = document.getElementById("create");
    var username = document.getElementById("username");
    var after = document.getElementById("after");
    var watchlive = document.getElementById("watchlive");
        var eCanvas = document.getElementById("energyDisplay");
        var saveGame = document.getElementById("saveGame");
        var replayNames = document.getElementById("names");
        var gLeaderBoard;
var eCtx = eCanvas.getContext("2d");

socket.on("reconnect", function(){
  location.reload();
})

socket.on("disconnect", function(){
// alert("Server has disconnected. If it's being restarted, wait until the connection is re-established.");
})

    btn.onclick = function() {
      if(username.value.length<=30){
      btn.style.display = "none";
      username.style.display = "none";
      after.innerHTML = "Note: If another player has the username you entered, your bot will not work.<br>Username: " + username.value + "<br>Bot Key: " + key + "<br><br>";
      socket.emit("newPlayer", { "key": key, "username": username.value })
    } else{
      username.value = "Too long, reload and try again!";
    }
    }
    
    


    var playerImgs = {
      rednorth: document.getElementById("rednorth"),
      redsouth: document.getElementById("redsouth"),
      redeast: document.getElementById("redeast"),
      redwest: document.getElementById("redwest"),
      bluenorth: document.getElementById("bluenorth"),
      bluesouth: document.getElementById("bluesouth"),
      blueeast: document.getElementById("blueeast"),
      bluewest: document.getElementById("bluewest"),
      greynorth: document.getElementById("greynorth"),
      greysouth: document.getElementById("greysouth"),
      greyeast: document.getElementById("greyeast"),
      greywest: document.getElementById("greywest"),
      yellownorth: document.getElementById("yellownorth"),
      yellowsouth: document.getElementById("yellowsouth"),
      yelloweast: document.getElementById("yelloweast"),
      yellowwest: document.getElementById("yellowwest")
    }
    
    



    socket.emit("display");
    
              if(localStorage.getItem("savedGame1") !== null){
                let gameInd = 1;
      while(localStorage.getItem("savedGame" + gameInd) !== null){
                    addSavedGame(JSON.parse(localStorage.getItem("savedGame" + gameInd)).players, gameInd);
        gameInd++;
      }
      }
    var game;
    var rollbacking = false;
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d")
    var size = 20;
    var xSize = canvas.width / size;
    var ySize = canvas.height / size;

    ctx.fillStyle = "black";

    function drawGrid() {
      ctx.beginPath();
      for (let x = 0; x <= canvas.width; x += xSize) {
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
      }
      for (let y = 0; y <= canvas.width; y += ySize) {
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
      }
    }

    function show(gameToDraw) {

      for (var i = 0; i < gameToDraw.barricades.length; i++) {
        ctx.fillStyle = "pink";
        ctx.fillRect(gameToDraw.barricades[i][0] * xSize, gameToDraw.barricades[i][1] * ySize, xSize, ySize)
      }
      
for(let i=0;i<gameToDraw.players.length;i++) {
  if(!(gameToDraw.players[i].dir== "south" || gameToDraw.players[i].dir== "north" ||gameToDraw.players[i].dir== "east" || gameToDraw.players[i].dir== "west"  )){
    gameToDraw.players[i].dir = "south";
  }
        ctx.drawImage(playerImgs[gameToDraw.players[i].color + gameToDraw.players[i].dir], gameToDraw.players[i].pos[0] * xSize, gameToDraw.players[i].pos[1] * ySize, xSize, ySize);

    
  }

    }
    function bases(game) {
      for (var i = 0; i < game.bases.length; i++) {
      ctx.fillStyle = game.players[i].color;
      ctx.fillRect(game.bases[i].pos[0] * xSize, game.bases[i].pos[1] * ySize, xSize, ySize);
      ctx.font = "20px Arial";
        ctx.fillStyle = "white"
        ctx.fillText(game.bases[i].energy, game.bases[i].pos[0] * xSize, (game.bases[i].pos[1] * ySize) + ySize);
      }
    }

    function nodes(loopArr) {
      for (var i = 0; i < loopArr.length; i++) {
        ctx.fillStyle = "purple";
        ctx.fillRect(loopArr[i].pos[0] * xSize, loopArr[i].pos[1] * ySize, xSize, ySize);
        ctx.font = "20px Arial";
        ctx.fillStyle = "white"
        ctx.fillText(loopArr[i].energy, loopArr[i].pos[0] * xSize, (loopArr[i].pos[1] * ySize) + ySize);
      }
    }

    function clear(x, y) {
      ctx.fillStyle = "white";
      ctx.fillRect(((x) * xSize), ((y) * ySize), xSize, ySize);
      ctx.fillStyle = "black";
      ctx.strokeStyle = "black";
      ctx.lineWidth = 1.5;
      ctx.strokeRect((x) * xSize, (y) * ySize, xSize, ySize);
    }
    var games;
    drawGrid();
      let rerunLoop;
          let ind = 0;
      var time = document.getElementById("time");
      document.getElementById("speed").oninput = function(){
 clearInterval(rerunLoop);
 rerunLoop =  setInterval(loop,304 - document.getElementById("speed").value);
     }
      
      
      time.oninput = function() { changeTime(time.value); };
      function changeTime(newTime, intTime){ //In order to not have to save energy states in the replay.JSON database, for rollbacks I have to start from turn 0 and simulate the game up to where the user wants to rollback to.
     if(newTime < rerunObj.turns.length-1){
       winText.style.display = "none";
       winText.innerHTML = "";
     }
     
     
        clearInterval(rerunLoop);
        //time.value = tempNum;
        for(var k = 0;k<rerunObj.players.length;k++){
          try{
          clear(rerunObj.players[k].pos[0],rerunObj.players[k].pos[1]);
          rerunObj.players[k].energy = 0;
          }catch(err){
          }
        }
        //Setting ind to 0 and setting all bases, node, and player energy to 0 to initiate the simulation.
         ind = 0;
        for(var i=0;i<rerunObj.nodes.length;i++){
          rerunObj.nodes[i].energy = 0;
        }
        for(var j=0;j<rerunObj .bases.length;j++){
          rerunObj .bases[j].energy = 0;
        }
        for(let i=0;i<newTime;i++){
          loop(true);
        }
        ind = newTime;
          rerunLoop  = setInterval(function(){loop(false);}, 304 -  document.getElementById("speed").value);
      }
      saveGame.onclick = function(){
        let gameInd = 1;
      while(localStorage.getItem("savedGame" + gameInd) !== null){
        gameInd++;
      }
      localStorage.setItem("savedGame" + gameInd, JSON.stringify(rerunObj));
      addSavedGame(rerunObj.players, gameInd);
      }
      
      watchlive.onclick = function(){
        clearInterval(rerunLoop);
                document.getElementById("unsaveGame").style.display = "none";
        ind = 0;
    ctx.fillStyle = "white"; // clearing canvas
    ctx.fillRect(0,0,600,600);
    drawGrid();
        eCtx.fillStyle = "white";
        eCtx.fillRect(0,0,eCanvas.width, eCanvas.height);
    rollbacking = false;
    winText.style.display = "none";
    watchlive.style.display = "none";
    saveGame.style.display = "none";
    time.style.display = "none";
    selectGame.style.display = "block";
    document.getElementById("speed").style.display = "none";
        document.documentElement.scrollTop = 83;
      }
      document.getElementById("unsaveGame").onclick = function(){
       document.getElementById("saved").innerHTML = '<b>Saved Games</b><br><button onclick = "clearSavedGames();">Clear</button>';
       let i=savedGameInd;
       while(localStorage.getItem("savedGame" + (i+1))!== null){ 
       localStorage.setItem("savedGame" + (i), localStorage.getItem("savedGame" + (i+1)));
         i++;
          }
        localStorage.removeItem("savedGame" +i);
          let gameInd = 1;
          while(localStorage.getItem("savedGame" + gameInd) !== null){
                addSavedGame(JSON.parse(localStorage.getItem("savedGame" + gameInd)).players, gameInd);
            gameInd++;
          }          
    }
      
  socket.on("rerunGameData", function(data){
    replayGame(data);
            document.getElementById("unsaveGame").style.display = "none";
        document.getElementById("saveGame").style.display = "block";
  });
  function replayGame(data){
    document.documentElement.scrollTop = 83;
    winText.style.display = "none";
    winText.innerHTML = "";
    selectGame.style.display = "none";
    rollbacking = true;
    watchlive.style.display = "block";
    saveGame.style.display = "block";
    time.style.display = "block";
    document.getElementById("speed").style.display = "block";
    clearInterval(rerunLoop); //Stops reruns that are currently running to initiate this one.
    rerunObj = data; //Global variable.
    ind = 0; //On top of resetting any other games running, we need to set the ind to 0.
    ctx.fillStyle = "white"; // clearing canvas
    ctx.fillRect(0,0,600,600);
    drawGrid();
    time.max = rerunObj.turns.length-1; //for rollbacking, set the max value of the time slider to the number of turns.
    rerunLoop  = setInterval(loop, 304 - document.getElementById("speed").value); //initiates game rollback.
  }
     function loop(isRerunning) {
      rerunObj.players[ind % rerunObj.players.length].pos = rerunObj.turns[ind];
     

      
          if(ind > rerunObj.players.length-1){
        clear(rerunObj.turns[ind-rerunObj.players.length][0],rerunObj.turns[(ind-rerunObj.players.length)][1])
      }
      
      
    if(!isRerunning){  
      time.value = ind;
    }
    
        if (ind % 3 == 0) {
        for (var i = 0; i < rerunObj.nodes.length; i++) {
          rerunObj.nodes[i].energy++;
        }
      }
    
      checkNodes(rerunObj.players[ind % rerunObj.players.length], rerunObj.nodes)

          checkCollide(rerunObj.players, rerunObj .bases)
          checkBase(rerunObj.players,rerunObj .bases)
          let tempTurn = 0;
          if(ind > rerunObj.turns.length-rerunObj.players.length){
            tempTurn = rerunObj.turns.length-rerunObj.players.length;
          } else{
            tempTurn = ind;
          }
         scoreboard(rerunObj.players, rerunObj .bases, (tempTurn) +"/" + (rerunObj.turns.length-rerunObj.players.length) )
    nodes(rerunObj.nodes)
 energyCanvas(rerunObj.players, rerunObj.bases)
      for (var i = 0; i < rerunObj.barricades.length; i++) {
        ctx.fillStyle = "pink"
        ctx.fillRect(rerunObj.barricades[i][0] * xSize, rerunObj.barricades[i][1] * ySize, xSize, ySize)
        
      }
            if(ind > rerunObj.players.length){
bases(rerunObj)
}

      if(rerunObj.players[ind% rerunObj.players.length].dir == "" ||rerunObj.players[ind% rerunObj.players.length].dir == null  ){
        rerunObj.players[ind% rerunObj.players.length].dir = "south"
      }
      if(ind > rerunObj.players.length){
      for(let i=0;i<rerunObj.players.length;i++){
       ctx.drawImage(playerImgs[rerunObj.players[i].color + rerunObj.players[i].dir], rerunObj.players[i].pos[0] * xSize, rerunObj.players[i].pos[1] * ySize, xSize, ySize);
      }
      }
      
      ind++;
      if(ind >= rerunObj.turns.length){
        if(rerunObj.winnerId == "tie"){
                winText.style.display = "inline-block";
      winText.innerHTML = "Tie!<br>Better luck next time!";
        } else{
        displayWinner(rerunObj.players[rerunObj.winnerId].color,rerunObj.players[rerunObj.winnerId].name,rerunObj .bases[rerunObj.winnerId].energy, rerunObj.winnerId);
        clearInterval(rerunLoop);
      }
      }
}

    socket.on("replayNames", function(obj){
       stringArr = obj.rerunStr;
       leaderBoard(JSON.parse(obj.scoreArray));
replaySelect(stringArr);    
    })
    socket.on("queue", function(data) {
      games = data;
      if(!rollbacking){
      for (var i = 0; i < data.length; i++) {
        if (data[i].running) {
                       ctx.fillStyle = "white";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      drawGrid();
          game = data[i];
          break;
        
        }
        }
      }

    })
   socket.on("endGame", function(obj){
for(let i=0;i<gLeaderBoard.length;i++){
 if(gLeaderBoard[i][0] == obj.winner.name){
   gLeaderBoard[i][1]+=15;
   break;
 }
}
 console.log("Game Players: " + games[obj.gameId].players);
 for(let player of games[obj.gameId].players){
   if(player.name != obj.winner.name){
     console.log("loser " + player.name);
     for(let i=0;i<gLeaderBoard.length;i++){
       if(player.name == gLeaderBoard[i][0]){
         console.log("match " +  player.name, gLeaderBoard[i][0])
         gLeaderBoard[i][1] -=5;
         if(gLeaderBoard[i][1] < 0){
           gLeaderBoard[i][1] = 0;
         }
       }
     }
   }
 }

gLeaderBoard.sort(function(a, b) {
    return b[1] - a[1];
});


console.log("sorterd " + gLeaderBoard)

leaderBoard(gLeaderBoard);
     if(!rollbacking){
     if(games[parseInt(selectGame.options[selectGame.selectedIndex].value)].gameId == obj.gameId ){
   if(obj.winner == "tie"){
      winText.style.display = "inline-block";
      winText.innerHTML = "Tie!<br>Better luck next time!";
   } else{
displayWinner(obj.winner.color, obj.winner.name, obj.base.energy, obj.winner.id);
   }
   
   for(let i=0;i<games.length;i++){
     if(games[i].running){
       
       break;
     }
   }
     }
     }
     
     
     

     
     
     
   })
    socket.on("draw", function(data) {
      for(let game of data){
        if(game.turn >= game.totalTurns + game.players.length){
                while(stringArr.length > 19){
        stringArr.shift();
      }
            let tempStr = "";
            for(let i =0;i<game.players.length;i++){
        tempStr += games[ind].players[i].name + " ";
      }
stringArr.push(tempStr);
replaySelect(stringArr);
        }
      }
      if(!rollbacking){
        winText.style.display  = "none";
        winText.innerHTML = "";
 let gameToDraw = data[parseInt(selectGame.options[selectGame.selectedIndex].value)];
      if (gameToDraw.running) {
        if(lastCoords != null){
  for (let i = 0; i < gameToDraw.players.length; i++) {
          clear(lastCoords.players[i].pos[0], lastCoords.players[i].pos[1]);
        }
}

lastCoords = gameToDraw;

        time.style.display = "none";
        scoreboard(gameToDraw.players, gameToDraw.bases,  (gameToDraw.turn-gameToDraw.players.length) + "/" + (gameToDraw.totalTurns))
        nodes(gameToDraw.nodes);
        bases(gameToDraw);
          show(gameToDraw)
          energyCanvas(gameToDraw.players, gameToDraw.bases)
          // ctx.drawImage(document.getElementById("live"),xSize * 9,0,60,ySize);
        }
      
     
}
    })

    var selectGame = document.getElementById("selectGame");
    selectGame.onchange = function() {
      
      ctx.fillStyle = "white";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      drawGrid();
    }
    
    function scoreboard(players,bases, turnStr){
        document.getElementById("turnStr").innerHTML = "Turn: <b>" + turnStr + "</b>";
        for (var i = 0; i < players.length; i++) {
          document.getElementById("player" + i).innerHTML = "";
          document.getElementById("player" + i).innerHTML += "Player" + (i+1) + ": <br>name: " + players[i].name + "<br>ELO: " + players[i].elo + "<br>base energy: " + bases[i].energy + "<br>energy: " + players[i].energy;
        }
    }
    
    
    function checkBase(players, bases){
        for(var i=0;i<players.length;i++){
        if (players[i].pos[1] == bases[i].pos[1] && players[i].pos[0] == bases[i].pos[0]) {
          bases[i].energy += players[i].energy
          players[i].energy = 0;
        }

          for(var j=0;j<players.length;j++){
            if(j != i){
                        if (players[j].pos[1] == bases[i].pos[1] && players[j].pos[0] == bases[i].pos[0]) {
   
          players[j].energy += bases[i].energy
         bases[i].energy= 0;


         
        }
          }
          }
        }
}







function checkNodes(player, nodes){
    for (var i = 0; i < nodes.length; i++) {
        if (player.pos[1] == nodes[i].pos[1] && player.pos[0] == nodes[i].pos[0]) {
          player.energy += nodes[i].energy;
          nodes[i].energy = 0;
        }
      }
}

function checkCollide(players, bases){
  for (var i = 0; i < players.length; i++) {
        for (let j = 0; j < players.length; j++) {
          if (j != i) {
            if (players[i].pos[1] == players[j].pos[1] && players[i].pos[0] == players[j].pos[0]) {
              const avg = players[i].energy + players[j].energy;
              if (players[i].energy > players[j].energy) {
                players[i].energy = Math.ceil(avg / 2)
                players[j].energy = Math.floor(avg / 2)
              }
              else if (players[i].energy < players[j].energy) {
                players[j].energy = Math.ceil(avg / 2)
                players[i].energy = Math.floor(avg / 2)
              
            }
            }
            }
          }


        }
        

      
}
    
    
    function displayWinner(color,name,baseEnergy, id){
      winText.style.display = "inline-block";
     winText.innerHTML = "Winner: <span style = 'color: " +  color +  ";'>" + name + "</span>" + " (Player " + (id+1) +")<br>" + name + " won with an astounding base energy score of " + baseEnergy  +"!" 
    }

    function addGame(str){ //Adds games to the replay selection when they end.
          let htmlCommand = 'socket.emit("rerunGame", parseInt(this.innerHTML.substring(0,this.innerHTML.indexOf(".")))-1); console.log(parseInt(this.innerHTML.substring(0,this.innerHTML.indexOf(".")))-1)'
          
let html ="<p onclick = '" + htmlCommand + "'>" +  str + "</p>" ;
         replayNames.innerHTML= '<b>Recent Games (Last 20)</b>' + html + replayNames.innerHTML.substring(replayNames.innerHTML.indexOf("</b>") + 4, replayNames.innerHTML.length);
    }
    
    
    function energyCanvas(players,bases){
      let energySum  = 0;
      for(let i=0;i<players.length;i++){
         energySum+= players[i].energy;
         energySum+= bases[i].energy 
      }
      let drawY = 0;
      for(let player of players){

        eCtx.fillStyle = player.color;
eCtx.fillRect(0,drawY,eCanvas.width, ((player.energy + bases[player.id].energy)/energySum) * 600 );
        drawY += ((player.energy + bases[player.id].energy)/energySum) * 600;
      }
    }
    
    function addSavedGame(players, gameInd){
                let str = gameInd + ". ";
          for(let i=0;i<players.length;i++){
            str+=players[i].name + " ";
          }
          
          var htmlCommand = 'savedGameInd = parseInt(this.innerHTML.substring(0,this.innerHTML.indexOf(".")));replayGame(JSON.parse(localStorage.getItem("savedGame" + savedGameInd)));document.getElementById("unsaveGame").style.display = "block";document.getElementById("saveGame").style.display = "none";';
          let html ="<p onclick = '" + htmlCommand + "'>" +  str + "</p>";
         document.getElementById("saved").innerHTML= document.getElementById("saved").innerHTML + html;
    }
    
    function clearSavedGames(){
                    if(localStorage.getItem("savedGame1") !== null){
                let gameInd = 1;
      while(localStorage.getItem("savedGame" + gameInd) !== null){
                   localStorage.removeItem("savedGame" + gameInd);
        gameInd++;
      }
              document.getElementById("saved").innerHTML = '<b>Saved Games</b><br><button onclick = "clearSavedGames();">Clear</button>';
    }
      
    }
    
    function leaderBoard(mostWins){
      gLeaderBoard = mostWins;
            let leaderBoardStr = "<br>";
for(let i=0;i<mostWins.length;i++){
  leaderBoardStr+= (i+1) + ". " +mostWins[i][0] + " (" + mostWins[i][1] + ")<br>";
}
      document.getElementById("leaderboard").innerHTML = '<b>Leaderboard</b>' + leaderBoardStr;
    }
    
    function replaySelect(arr){

      replayNames.innerHTML = '<b>Recent Games (Last 20)<b><br>'
      
              let p = "";
    for(var i=arr.length-1;i>=0;i--){
    p = i+1 +". " +arr[i];
let htmlCommand = 'console.log(parseInt(this.innerHTML.substring(0,this.innerHTML.indexOf(".")))-1); socket.emit("rerunGame", parseInt(this.innerHTML.substring(0,this.innerHTML.indexOf(".")))-1);'
         replayNames.innerHTML =  replayNames.innerHTML + "<p onclick = '" + htmlCommand + "'>" + p + "</p>";
    }
    }
  </script>
</body>

</html>
